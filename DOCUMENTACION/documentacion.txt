-- Instrucciones para creación de base de datos:
-- 1. Ejecutar XAMPP
-- 2. Crear conexión con la extensión, si no la tienen la extensión se llama MySQL

-- Primero ejecutar esta línea!!
CREATE DATABASE BBDD_RESTAURANTE
    DEFAULT CHARACTER SET = 'utf8mb4';

    USE BBDD_RESTAURANTE;

    
CREATE TABLE MESERO (
    ID_MESERO INT(10) PRIMARY KEY AUTO_INCREMENT,
    NOMRE_MESERO VARCHAR(20)
);

CREATE TABLE CLIENTE (
    ID_CLIENTE INT(10) PRIMARY KEY AUTO_INCREMENT,
    TIPO_CLIENTE VARCHAR(20)
);

CREATE TABLE TIPO_PRODUCTO (
    ID_TIPO_PRODUCTO INT(10) PRIMARY KEY AUTO_INCREMENT,
    TIPO_NOMBRE VARCHAR(20)
);

CREATE TABLE CATEGORIA (
    ID_CATEGORIA INT(10) PRIMARY KEY AUTO_INCREMENT,
    CATEGORIA_NOMBRE VARCHAR(20)
);

CREATE TABLE PRODUCTO (
    ID_PRODUCTO INT(10) PRIMARY KEY AUTO_INCREMENT,
    PRODUCTO_NOMBRE VARCHAR(20),
    COSTO DECIMAL(5, 2),
    PRECIO DECIMAL(5, 2),
    ID_CATEGORIA INT(10),
    ID_TIPO_PRODUCTO INT(10),
    FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA (ID_CATEGORIA),
    FOREIGN KEY (ID_TIPO_PRODUCTO) REFERENCES TIPO_PRODUCTO (ID_TIPO_PRODUCTO)
);
 
CREATE TABLE ORDEN (
    ID_ORDEN INT(10) PRIMARY KEY AUTO_INCREMENT,
    FECHA_HORA DATETIME,
    MESA VARCHAR(20),
    PROPINA DECIMAL(5, 2),
    ID_MESERO INT(10),
    ID_CLIENTE INT(10),
    FOREIGN KEY (ID_MESERO) REFERENCES MESERO (ID_MESERO),
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE) 
); 

CREATE TABLE ORDEN_PRODUCTO (
    ID_ORDEN_PRODUCTO INT(10) PRIMARY KEY AUTO_INCREMENT,
    ID_ORDEN INT(10),
    ID_PRODUCTO INT(10),
    FOREIGN KEY (ID_ORDEN) REFERENCES ORDEN (ID_ORDEN),
    FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTO (ID_PRODUCTO)
);

====================================================================================



 -- Intrucciones de uso:
-- 1. Haber creado base de datos previamente
-- 2. Copiar y pegar carpeta de Carga Masiva ubicada en el repositorio en la siguiente ruta: C:\xampp\mysql\data
        USE BBDD_RESTAURANTE;

        -- Script para borrar datos de las tablas en caso de que la tabla ya cuente con 
registros

DELETE FROM PRODUCTO;
DELETE FROM ORDEN;
DELETE FROM MESERO;
DELETE FROM CLIENTE;
DELETE FROM TIPO_PRODUCTO;
DELETE FROM CATEGORIA;
DELETE FROM ORDEN_PRODUCTO; 

-- Reinicia el ID autoincrementable en 0 para que no hayan errores con el número de ID

ALTER TABLE producto AUTO_INCREMENT = 0;
ALTER TABLE orden AUTO_INCREMENT = 0;
ALTER TABLE Mesero AUTO_INCREMENT = 0;
ALTER TABLE Cliente AUTO_INCREMENT = 0;
ALTER TABLE Tipo_Producto AUTO_INCREMENT = 0;
ALTER TABLE Categoria AUTO_INCREMENT = 0;
ALTER TABLE ORDEN_PRODUCTO AUTO_INCREMENT = 0;

-- Carga masiva de tabla Mesero

LOAD DATA INFILE 'Carga Masiva/Mesero.csv'
REPLACE INTO TABLE Mesero
FIELDS TERMINATED BY ';' 
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(NOMRE_MESERO); 
-- Carga masiva de tabla Cliente
LOAD DATA INFILE 'Carga Masiva/Cliente.csv'
REPLACE INTO TABLE Cliente
FIELDS TERMINATED BY ';' 
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(TIPO_CLIENTE);
-- Carga masiva de tabla Tipo_Producto
LOAD DATA INFILE 'Carga Masiva/Tipo_Producto.csv'
REPLACE INTO TABLE Tipo_Producto
FIELDS TERMINATED BY ';' 
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(TIPO_NOMBRE);
-- Carga masiva de tabla Categoria
LOAD DATA INFILE 'Carga Masiva/Categoria.csv'
REPLACE INTO TABLE Categoria
FIELDS TERMINATED BY ';' 
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(CATEGORIA_NOMBRE);
-- Carga masiva de tabla Producto
LOAD DATA INFILE 'Carga Masiva/Producto.csv'
REPLACE INTO TABLE producto
FIELDS TERMINATED BY ';' 
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(PRODUCTO_NOMBRE, COSTO, PRECIO, ID_CATEGORIA, ID_TIPO_PRODUCTO);
-- Carga masiva de tabla Orden
LOAD DATA INFILE 'Carga Masiva/Orden.csv'
REPLACE INTO TABLE orden
FIELDS TERMINATED BY ';' 
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(FECHA_HORA, MESA, PROPINA, ID_MESERO, ID_CLIENTE);
-- Carga masiva de tabla ORDE_PRODUCTO
LOAD DATA INFILE 'Carga Masiva/ORDEN_PRODUCTO.csv'
REPLACE INTO TABLE ORDEN_PRODUCTO
FIELDS TERMINATED BY ';' 
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(ID_ORDEN, ID_PRODUCTO);
